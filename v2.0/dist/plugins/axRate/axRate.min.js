/*!
 *Last modified: 2022-09-06 16:51:16
 *名称: axRate.js
 *简介: 评星插件的js文件
 *用法: new axRate('#id',{参数})
 *版本: v1.0.0
 *演示: https://www.axui.cn/v2.0/ax-rate.php
 *客服: 3217728223@qq.com
 *交流: QQ群952502085
 *作者: AXUI团队
 */
class t{constructor(t,i){this.targetDom=axIdToDom(t),this.options=axExtend({half:!1,icon:"ax-iconfont ax-icon-star-f",count:5,multiplier:1,value:0,readonly:!1,popShow:!1,popTheme:"ad",popFormat:"<i stars></i>星,总分:<i value></i>",tipsShow:!1,tipsFormat:"<i stars></i>星,总分:<i value></i>",clearShow:!1,size:"",rendered:"",getValue:"",setValue:""},i,this.targetDom),this.handlers={},this.value=0,this.stars=0,this.items=[],this.init()}init(){let t,i=this;this.renderRate(),this.set(this.options.value),this.options.popShow&&(t=axAddElem("div",{class:"ax-rate-popcon"},this.options.popFormat),this.tooltip=new axTooltip(this.items[0].dom,{trigger:"none",theme:this.options.popTheme,content:t}),new axHover(i.ul,{enter:()=>{i.tooltip.popup.show()},leave:()=>{i.tooltip.popup.hide()},hold:i.tooltip.popup.targetDom})),this.options.readonly||(this.clear.onclick=function(){i.set(0)},this.items.forEach(s=>{let e=s.dom,l=e.firstElementChild,o=this.items.filter(t=>t.id<s.id),a=this.items.filter(t=>t.id>s.id);this.options.popShow&&new axHover(e,{enter:()=>{i.tooltip.popup.updatePosition(e)}}),e.onmousemove=function(e){let h=i.movePlace(e,this);o.forEach(t=>{t.dom.firstElementChild.classList.add("ax-full"),t.value=1}),"half"==h?(l.classList.remove("ax-full"),l.classList.add("ax-half")):"full"==h&&(l.classList.remove("ax-half"),l.classList.add("ax-full")),a.forEach(t=>{t.dom.firstElementChild.classList.remove("ax-half"),t.dom.firstElementChild.classList.remove("ax-full")}),i.options.popShow&&i.calculate(s,h,t),this.onclick=function(){s.value="half"==h?.5:"full"==h?1:0,i.calculate(s,h),i.options.tipsShow&&(i.tipsValue&&(i.tipsValue.innerHTML=i.value),i.tipsStars&&(i.tipsStars.innerHTML=i.stars)),i.options.getValue&&i.options.getValue.call(i,i.value,i.stars),"getValue"in i.handlers&&i.emit("getValue",i.value,i.stars)}}}),this.ul.onmouseleave=function(){i.set(i.value),i.options.setValue&&i.options.setValue.call(i,i.value,i.stars),"setValue"in i.handlers&&i.emit("setValue",i.value,i.stars)})}set(t){t<=0&&(t=0),t>=this.options.multiplier*this.options.count&&(t=this.options.multiplier*this.options.count);let i=t/this.options.multiplier,s=Math.floor(i),e=i-s;if(this.options.half||(e=0),t)for(let t=0;t<=s-1;t++){let i=this.items[t].dom.firstElementChild;i.classList.remove("ax-half"),i.classList.add("ax-full"),this.items[t].value=1}else this.items.forEach(t=>{let i=t.dom.firstElementChild;i.classList.remove("ax-half"),i.classList.remove("ax-full"),t.value=0});if(this.stars=s,.5==e){let t=this.items[s].dom.firstElementChild;t.classList.remove("ax-full"),t.classList.add("ax-half"),this.items[s].value=.5,this.stars+=.5,s++}for(let t=s;t<this.items.length;t++){let i=this.items[t].dom.firstElementChild;i.classList.remove("ax-half"),i.classList.remove("ax-full"),this.items[t].value=0}this.value=t,this.tipsValue&&(this.tipsValue.innerHTML=t),this.tipsStars&&(this.tipsStars.innerHTML=this.stars)}get(t){return{stars:this.stars,value:this.value,count:this.options.count,multiplier:this.options.multiplier}[t]}calculate(t,i,s){let e=this.items.filter(i=>i.id<t.id).length;"half"==i?e+=.5:"full"==i&&e++,s?(s.querySelector("[stars]").innerHTML=e,s.querySelector("[value]").innerHTML=this.options.multiplier*e):(this.value=this.options.multiplier*e,this.stars=e)}renderRate(){let t=document.createDocumentFragment(),i=`<li class="ax-item">\n                            ${`<i class="${this.options.icon}"></i>`.repeat(2)}\n                        </li>`;this.ul=axAddElem("ul"),this.tips=axAddElem("div",{class:"ax-tips"},this.options.tipsFormat),this.tipsStars=this.tips.querySelector("[stars]"),this.tipsValue=this.tips.querySelector("[value]"),this.clear=axAddElem("i",{class:"ax-iconfont ax-icon-close-o-f",clear:""}),this.options.clearShow&&t.appendChild(this.clear);for(let t=1;t<=this.options.count;t++){let s=axStrToDom(i),e={id:t,value:0,dom:s};this.items.push(e),this.ul.appendChild(s)}t.appendChild(this.ul),this.options.tipsShow&&t.appendChild(this.tips),this.options.size&&this.targetDom.setAttribute("size",this.options.size),this.targetDom.appendChild(t),this.options.rendered&&this.options.rendered.call(this),"rendered"in this.handlers&&this.emit("rendered","")}movePlace(t,i){if(!this.options.half)return"full";let s=i.getBoundingClientRect().left,e=s+~~((i.getBoundingClientRect().right-s)/2),l="full";return t.clientX<e&&(l="half"),l}on(t,i){return axAddPlan(t,i,this),this}emit(t,...i){axExePlan(t,this,...i)}off(t,i){return axDelPlan(t,i,this),this}}document.querySelectorAll("[axRate]").forEach(i=>{new t(i)});